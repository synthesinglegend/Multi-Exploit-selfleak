#include "decrypt_xor_aes.h"
#include "hikvision_masterkey.h"
#include "HTTPRequest.hpp"
#include "scoop_file.h"
#include <cstdlib>
#include <iostream>
#include <thread>
dec_data::~dec_data()
{
	delete[] fileBytes;
	delete[] aesKey;
	delete[] xorKey;
}

	void dec_data::openfile() {
		fileBytes = readInBytes(path, arrLength);
	}
	void dec_data::StartDecryptThread() {
		std::thread threadObject([this] {this->DecryptData(); });
		threadObject.detach();
	}

	void dec_data::DecryptData() {
		decryptAES(fileBytes, arrLength, aesKey);
		decryptXOR(fileBytes, arrLength, xorKey);
		isEncrypted = false;
	}
	void dec_data::savefile() {
		writeOutBytes(new_path, fileBytes, arrLength);
	}